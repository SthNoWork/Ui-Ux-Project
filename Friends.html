<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Movies Ahoy! Friends</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/Friends.css">
  </head>
  <body>
    <div class="iphone-screen">
      <!-- HEADER -->
      <div class="header">
        <div class="header-title">Movies Ahoy!</div>
        <div class="user-profile">
          <span id="username">Username</span>
          <span class="user-icon" id="userIcon"></span>
        </div>
      </div>

      <!-- SEARCH BAR -->
      <div class="search-container">
        <input
          type="text"
          placeholder="Search friends..."
          id="searchInput"
          class="search-input"
        />
      </div>

      <!-- FRIEND / REQUEST BUTTONS -->
      <div style="display: flex; gap: 10px; padding: 0 15px 10px">
        <button class="friends-btn active" id="friendsBtn">Friends</button>
        <button class="requests-btn" id="requestsBtn">Requests</button>
      </div>

      <!-- FRIEND LIST -->
      <div class="friend-list" id="friendList"></div>

      <!-- NAVIGATION BAR -->
      <div class="navigation-bar">
        <a href="Home.html" class="nav-item">
          <img src="images/Navigation/home.png" class="icon" />
          Home
        </a>
        <a href="Movies.html" class="nav-item">
          <img src="images/Navigation/movies.png" class="icon" />
          Movies
        </a>
        <a href="Groups.html" class="nav-item">
          <img src="images/Navigation/groups.png" class="icon" />
          Groups
        </a>
        <a href="Friends.html" class="nav-item">
          <img src="images/Navigation/friends.png" class="icon" />
          Friends
        </a>
        <a href="Settings.html" class="nav-item">
          <img src="images/Navigation/setting.png" class="icon" />
          Settings
        </a>
      </div>
    </div>

    <script>
      const friendsBtn = document.getElementById("friendsBtn");
      const requestsBtn = document.getElementById("requestsBtn");
      const friendList = document.getElementById("friendList");
      const searchInput = document.getElementById("searchInput");

      let mode = "friends";

      // UPDATED FRIENDS DATA

      const friendsData = [
        {
          username: "Alice",
          bio: "Movie lover and popcorn addict",
          movies: [
            "Inception",
            "Titanic",
            "Interstellar",
            "Avatar",
            "Snow White",
          ],
          avatar: "images/Avatars/alice.jpg",
        },
        {
          username: "Bob",
          bio: "Enjoys sci-fi and thrillers",
          movies: ["The Matrix", "Inception", "Snow White"],
          avatar: "images/Avatars/bob.jpg",
        },
        {
          username: "Evelyn",
          bio: "Loves thrillers",
          movies: ["Se7en", "Gone Girl", "Shutter Island", "Snow White"],
          avatar: "images/Avatars/evelyn.jpg",
        },
      ];

      const requestsData = [
        {
          username: "Charlie",
          bio: "Horror enthusiast",
          movies: ["It", "The Shining", "Get Out"],
          avatar: "images/Avatars/charlie.jpg",
        },
        {
          username: "Liam",
          bio: "Sci-fi & fantasy fan",
          movies: ["Star Wars", "Guardians of the Galaxy", "Avatar"],
          avatar: "images/Avatars/liam.jpg",
        },
      ];

      function renderList(filter = "") {
        friendList.innerHTML = "";
        let listData = mode === "friends" ? friendsData : requestsData;
        const filtered = listData.filter((u) =>
          u.username.toLowerCase().includes(filter.toLowerCase())
        );

        filtered.forEach((user, index) => {
          const card = document.createElement("div");
          card.classList.add("friend-card");

          const moviesShort =
            user.movies.slice(0, 2).join(", ") +
            (user.movies.length > 2 ? ", ..." : "");
          const moviesFull = user.movies.join(", ");

          let innerHTML = `
            <div class="friend-card-header">
              <img src="${user.avatar}" class="friend-avatar" />
              <span class="friend-username">${user.username}</span>
            </div>
            <p class="friend-bio">${user.bio}</p>
            <p class="friend-movies" data-all-movies="${moviesFull}">Movies watched: ${moviesShort}</p>
          `;

          if (mode === "requests") {
            innerHTML += `
              <div class="friend-actions">
                <button class="accept-btn" data-index="${index}">Accept</button>
                <button class="decline-btn" data-index="${index}">Decline</button>
              </div>
            `;
          }

          card.innerHTML = innerHTML;
          friendList.appendChild(card);
        });

        if (mode === "requests") {
          const acceptButtons = document.querySelectorAll(".accept-btn");
          const declineButtons = document.querySelectorAll(".decline-btn");

          acceptButtons.forEach((btn) => {
            btn.addEventListener("click", () => {
              const idx = btn.dataset.index;
              const user = requestsData.splice(idx, 1)[0];
              friendsData.push(user);
              renderList(searchInput.value);
            });
          });

          declineButtons.forEach((btn) => {
            btn.addEventListener("click", () => {
              const idx = btn.dataset.index;
              requestsData.splice(idx, 1);
              renderList(searchInput.value);
            });
          });
        }
      }

      friendsBtn.addEventListener("click", () => {
        mode = "friends";
        friendsBtn.classList.add("active");
        requestsBtn.classList.remove("active");
        renderList(searchInput.value);
      });

      requestsBtn.addEventListener("click", () => {
        mode = "requests";
        friendsBtn.classList.remove("active");
        requestsBtn.classList.add("active");
        renderList(searchInput.value);
      });

      searchInput.addEventListener("input", () =>
        renderList(searchInput.value)
      );

      renderList();
      // Load logged-in user's name
      const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));

      if (!loggedInUser) {
        window.location.href = "Login.html";
      } else {
        // Load username
        const usernameEl = document.getElementById("username");
        if (usernameEl) {
          usernameEl.textContent = loggedInUser.fullName;
        }

        // Load profile picture
        const userIcon = document.getElementById("userIcon");
        if (userIcon && loggedInUser.pfp) {
          userIcon.style.backgroundImage = `url(${loggedInUser.pfp})`;
          userIcon.style.backgroundSize = "cover";
          userIcon.style.backgroundPosition = "center";
        }
      }
    </script>
  </body>
</html>
